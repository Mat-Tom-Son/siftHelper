<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Org Search - Skills & People Discovery</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7f7f7;
            color: #111;
            min-height: 100vh;
            padding: 24px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e5e5e5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            overflow: hidden;
        }

        .header {
            background: #fff;
            color: #111;
            padding: 24px;
            border-bottom: 1px solid #eee;
        }
        .header-row {
            display: grid;
            grid-template-columns: 1fr minmax(320px, 520px);
            gap: 16px;
            align-items: center;
        }
        .header-title {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .header-quick {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 10px;
            padding: 10px;
        }
        .header-quick .form-row {
            grid-template-columns: 1fr auto auto;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .header p {
            font-size: 0.95rem;
            color: #555;
        }

        .tabs {
            display: none; /* Hide tab bar to make this a single-page layout */
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #4f46e5;
            border-bottom: 3px solid #4f46e5;
        }

        .tab:hover {
            background: #f1f5f9;
        }

        .content {
            padding: 24px;
        }

        .tab-content {
            display: block; /* Always show sections */
        }

        .search-section {
            margin-bottom: 30px;
        }

        .search-form {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e5e5e5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 8px;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #111;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.06);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .form-row-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            align-items: center;
        }

        .form-row-equal {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .btn {
            background: #111;
            color: #fff;
            border: 1px solid #111;
            padding: 12px 18px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.15s, transform 0.15s;
        }

        .btn:hover {
            transform: translateY(-1px);
            background: #000;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-count {
            font-weight: 600;
            color: #374151;
        }

        .person-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 14px;
            transition: box-shadow 0.2s, transform 0.2s;
        }

        .person-card:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.06);
            transform: translateY(-1px);
        }

        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .person-info h3 {
            color: #1f2937;
            margin-bottom: 5px;
        }

        .person-info p {
            color: #6b7280;
        }

        .person-score {
            background: #111;
            color: #fff;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .skill-tag {
            background: #efefef;
            color: #111;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .skill-tag.featured {
            background: #eaeaea;
            color: #000;
            border: 1px dashed #bbb;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analytics-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 10px;
            padding: 18px;
        }

        .analytics-card h3 {
            color: #1f2937;
            margin-bottom: 15px;
        }

        .skill-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .skill-stat:last-child {
            border-bottom: none;
        }

        .loading {
            text-align: center;
            padding: 32px;
            color: #666;
        }

        .error {
            background: #fff1f1;
            color: #b00020;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #ffd6d6;
            margin-top: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #374151;
        }

        /* Autocomplete styles */
        .autocomplete-wrapper {
            position: relative;
        }

        .suggestions {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            z-index: 1000;
            max-height: 220px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background: #f2f2f2;
        }

        /* Layout wrappers */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .section-full {
            grid-column: 1 / -1;
        }

        @media (max-width: 900px) {
            .header-row {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .sections-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-row">
                <div class="header-title">
                    <h1>Kymanox Custom Sift Wrapper</h1>
                    <p>Skills & People Discovery Platform</p>
                </div>
                <div class="header-quick">
                    <div class="form-row">
                        <div class="form-group" style="margin:0;">
                            <label for="quick-skill" style="margin-bottom:6px;">Quick Skill Query</label>
                            <div class="autocomplete-wrapper">
                                <input type="text" id="quick-skill" placeholder="e.g., React">
                                <div id="quick-skill-suggestions" class="suggestions" style="display:none;"></div>
                            </div>
                        </div>
                        <div class="form-group" style="margin:0; align-self:end;">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="whoKnowsSkill()">Who Knows This?</button>
                        </div>
                        <div class="form-group" style="margin:0; align-self:end;">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="findExperts()">Find Experts</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('skills')">🔍 Skills Search</button>
            <button class="tab" onclick="switchTab('org')">🏢 Org Structure</button>
            <button class="tab" onclick="switchTab('people')">👥 People Search</button>
            <button class="tab" onclick="switchTab('analytics')">📊 Analytics</button>
        </div>

        <div class="content">
            <div class="sections-grid">
            <!-- Skills Search -->
            <div id="skills-tab" class="tab-content active">
                <div class="search-section">
                    <div class="search-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="skills-input">Skills (comma-separated)</label>
                                <div class="autocomplete-wrapper">
                                    <input type="text" id="skills-input" placeholder="e.g., JavaScript, React, Python">
                                    <div id="skills-suggestions" class="suggestions" style="display:none;"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="skills-department">Department</label>
                                <select id="skills-department">
                                    <option value="">All Departments</option>
                                    <option value="Information Technology">Information Technology</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Product Development & Commercialization">Product Development</option>
                                    <option value="CQV">CQV</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="min-level">Min Level</label>
                                <select id="min-level">
                                    <option value="">Any Level</option>
                                    <option value="1">Beginner (1)</option>
                                    <option value="2">Intermediate (2)</option>
                                    <option value="3">Advanced (3)</option>
                                    <option value="4">Expert (4)</option>
                                    <option value="5">Master (5)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="require-all"> Require ALL skills (default: ANY)
                            </label>
                            <label>
                                <input type="checkbox" id="featured-only"> Featured skills only
                            </label>
                        </div>
                        <button class="btn" onclick="searchSkills()">🔍 Search Skills</button>
                    </div>
                </div>

                

                <div id="skills-results" class="results"></div>
            </div>

            <!-- Org Structure -->
            <div id="org-tab" class="tab-content">
                <div class="search-section">
                    <div class="search-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="person-email">Person Email</label>
                                <input type="email" id="person-email" placeholder="e.g., john.doe@company.com">
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn" onclick="findManager()">Find Manager</button>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn" onclick="findReports()">Find Reports</button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="department-name">Department Name</label>
                                <input type="text" id="department-name" placeholder="e.g., Information Technology">
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn" onclick="departmentInfo()">Department Info</button>
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn" onclick="findDeptManagers()">Find Managers</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="org-results" class="results"></div>
            </div>
        </div>
    </div>

    <script>

        // API helper function
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Skills search functions
        async function searchSkills() {
            const skillsInput = document.getElementById('skills-input').value.trim();
            if (!skillsInput) {
                alert('Please enter at least one skill');
                return;
            }

            const skills = skillsInput.split(',').map(s => s.trim()).filter(s => s);
            const department = document.getElementById('skills-department').value;
            const minLevel = document.getElementById('min-level').value;
            const requireAll = document.getElementById('require-all').checked;
            const featuredOnly = document.getElementById('featured-only').checked;

            showLoading('skills-results');

            try {
                const result = await apiCall('/api/skills/search', {
                    method: 'POST',
                    body: JSON.stringify({
                        skills,
                        requireAll,
                        minLevel: minLevel ? parseInt(minLevel) : undefined,
                        department: department || undefined,
                        featuredOnly,
                        limit: 20
                    })
                });

                displaySkillsResults(result.results, 'skills-results');
            } catch (error) {
                showError('skills-results', 'Failed to search skills: ' + error.message);
            }
        }

        async function whoKnowsSkill() {
            const skill = document.getElementById('quick-skill').value.trim();
            if (!skill) {
                alert('Please enter a skill');
                return;
            }

            const department = document.getElementById('skills-department').value;
            showLoading('skills-results');

            try {
                const result = await apiCall(`/api/skills/who-knows/${encodeURIComponent(skill)}${department ? '?department=' + encodeURIComponent(department) : ''}`);
                showTextResult('skills-results', result.response);
            } catch (error) {
                showError('skills-results', 'Failed to search skill: ' + error.message);
            }
        }

        async function findExperts() {
            const skill = document.getElementById('quick-skill').value.trim();
            if (!skill) {
                alert('Please enter a skill');
                return;
            }

            const department = document.getElementById('skills-department').value;
            showLoading('skills-results');

            try {
                const result = await apiCall(`/api/skills/experts/${encodeURIComponent(skill)}${department ? '?department=' + encodeURIComponent(department) : ''}`);
                showTextResult('skills-results', result.response);
            } catch (error) {
                showError('skills-results', 'Failed to find experts: ' + error.message);
            }
        }

        // Org structure functions
        async function findManager() {
            const email = document.getElementById('person-email').value.trim();
            if (!email) {
                alert('Please enter an email address');
                return;
            }

            showLoading('org-results');

            try {
                const result = await apiCall(`/api/org/manager/${encodeURIComponent(email)}`);
                showTextResult('org-results', result.response);
            } catch (error) {
                showError('org-results', 'Failed to find manager: ' + error.message);
            }
        }

        async function findReports() {
            const email = document.getElementById('person-email').value.trim();
            if (!email) {
                alert('Please enter an email address');
                return;
            }

            showLoading('org-results');

            try {
                const result = await apiCall(`/api/org/reports/${encodeURIComponent(email)}`);
                showTextResult('org-results', result.response);
            } catch (error) {
                showError('org-results', 'Failed to find reports: ' + error.message);
            }
        }

        async function departmentInfo() {
            const department = document.getElementById('department-name').value.trim();
            if (!department) {
                alert('Please enter a department name');
                return;
            }

            showLoading('org-results');

            try {
                const result = await apiCall(`/api/org/department/${encodeURIComponent(department)}`);
                showTextResult('org-results', result.response);
            } catch (error) {
                showError('org-results', 'Failed to get department info: ' + error.message);
            }
        }

        async function findDeptManagers() {
            const department = document.getElementById('department-name').value.trim();
            if (!department) {
                alert('Please enter a department name');
                return;
            }

            showLoading('org-results');

            try {
                const result = await apiCall(`/api/org/managers/${encodeURIComponent(department)}`);
                // Render a simple summary list to avoid dependency on removed people renderer
                const managers = result.results || [];
                const lines = managers.map(p => `${p.displayName || p.primaryEmail} — ${p.title || ''}${p.departmentName ? ` • ${p.departmentName}` : ''}`);
                const text = lines.length ? `Managers in ${department} (${lines.length}):\n\n- ` + lines.join('\n- ') : `No managers found in ${department}.`;
                showTextResult('org-results', text);
            } catch (error) {
                showError('org-results', 'Failed to find managers: ' + error.message);
            }
        }

        

        // --- Autocomplete helpers ---
        function debounce(fn, delay = 200) {
            let t;
            return (...args) => {
                clearTimeout(t);
                t = setTimeout(() => fn(...args), delay);
            };
        }

        function currentTokenFromCommaSeparated(value, caretPos) {
            // Determine token boundaries around caret by comma separation
            const left = value.slice(0, caretPos);
            const right = value.slice(caretPos);
            const leftIndex = left.lastIndexOf(',');
            const rightIndex = right.indexOf(',');
            const start = leftIndex === -1 ? 0 : leftIndex + 1;
            const end = rightIndex === -1 ? value.length : caretPos + rightIndex;
            const token = value.slice(start, end).trimStart();
            const leadingSpaces = value.slice(start, end).length - value.slice(start, end).trimStart().length;
            return { start, end, token, leadingSpaces };
        }

        function replaceToken(value, start, end, replacement, leadingSpaces = 0) {
            const pad = ' '.repeat(leadingSpaces);
            const before = value.slice(0, start);
            const after = value.slice(end);
            // Ensure comma separation formatting
            const needsCommaBefore = before.trim().length > 0 && before.trim().slice(-1) !== ',' && before.slice(-1) !== ',';
            const prefix = needsCommaBefore && before.slice(-1) !== ' ' ? before + ' ' : before;
            const rep = pad + replacement;
            let result = prefix + rep;
            // If there are more tokens after, keep comma; otherwise add comma+space for easy chaining
            if (after.trim().length > 0) {
                // if after begins with comma, keep as is; otherwise add comma if needed
                if (after.trimStart().startsWith(',')) {
                    result += after;
                } else {
                    result += ', ' + after.trimStart();
                }
            } else {
                result += ', ';
            }
            return result;
        }

        async function fetchSkillSuggestions(query, limit = 8) {
            if (!query || query.length < 1) return [];
            try {
                const res = await apiCall(`/api/skills/suggestions?query=${encodeURIComponent(query)}&limit=${limit}`);
                return res.suggestions || [];
            } catch (e) {
                return [];
            }
        }

        function setupAutocomplete({ inputId, listId, multi = false }) {
            const input = document.getElementById(inputId);
            const list = document.getElementById(listId);
            let activeIndex = -1;
            let items = [];

            function renderList(suggestions) {
                items = suggestions;
                activeIndex = -1;
                if (!suggestions || suggestions.length === 0) {
                    list.style.display = 'none';
                    list.innerHTML = '';
                    return;
                }
                list.innerHTML = suggestions.map((s, i) => `<div class="suggestion-item" data-index="${i}">${s}</div>`).join('');
                list.style.display = 'block';
            }

            const doSuggest = debounce(async () => {
                const value = input.value;
                let q = value.trim();
                if (multi) {
                    const caret = input.selectionStart || value.length;
                    const { token } = currentTokenFromCommaSeparated(value, caret);
                    q = token.trim();
                }
                if (!q) { renderList([]); return; }
                const suggestions = await fetchSkillSuggestions(q, 8);
                renderList(suggestions);
            }, 200);

            input.addEventListener('input', doSuggest);
            input.addEventListener('focus', doSuggest);

            input.addEventListener('keydown', (e) => {
                const isOpen = list.style.display !== 'none';
                if (!isOpen) return;
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    activeIndex = (activeIndex + 1) % items.length;
                    updateActive();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    activeIndex = (activeIndex - 1 + items.length) % items.length;
                    updateActive();
                } else if (e.key === 'Enter') {
                    if (activeIndex >= 0 && activeIndex < items.length) {
                        e.preventDefault();
                        applySelection(items[activeIndex]);
                    }
                } else if (e.key === 'Escape') {
                    list.style.display = 'none';
                }
            });

            function updateActive() {
                const children = Array.from(list.children);
                children.forEach((el, i) => el.classList.toggle('active', i === activeIndex));
                const activeEl = children[activeIndex];
                if (activeEl) {
                    const rect = activeEl.getBoundingClientRect();
                    const listRect = list.getBoundingClientRect();
                    if (rect.bottom > listRect.bottom) list.scrollTop += rect.bottom - listRect.bottom;
                    if (rect.top < listRect.top) list.scrollTop -= listRect.top - rect.top;
                }
            }

            list.addEventListener('mousedown', (e) => {
                // Prevent input blur before click handler runs
                e.preventDefault();
            });
            list.addEventListener('click', (e) => {
                const item = e.target.closest('.suggestion-item');
                if (!item) return;
                const idx = parseInt(item.getAttribute('data-index'));
                if (isNaN(idx)) return;
                applySelection(items[idx]);
            });

            function applySelection(valueToInsert) {
                if (!multi) {
                    input.value = valueToInsert;
                } else {
                    const value = input.value;
                    const caret = input.selectionStart || value.length;
                    const seg = currentTokenFromCommaSeparated(value, caret);
                    input.value = replaceToken(value, seg.start, seg.end, valueToInsert, seg.leadingSpaces);
                }
                list.style.display = 'none';
                // Trigger change for any listeners
                const evt = new Event('input', { bubbles: true });
                input.dispatchEvent(evt);
            }

            document.addEventListener('click', (e) => {
                if (!list.contains(e.target) && e.target !== input) {
                    list.style.display = 'none';
                }
            });
        }

        // Display functions
        function displaySkillsResults(results, containerId) {
            const container = document.getElementById(containerId);
            
            if (!results || results.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No Results Found</h3>
                        <p>Try adjusting your search criteria or using different skills.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="results-header">
                    <div class="results-count">Found ${results.length} people</div>
                </div>
            `;

            results.forEach(person => {
                const skills = person.matchedSkills || [];
                const skillsHtml = skills.map(skill => 
                    `<span class="skill-tag ${skill.isFeatured ? 'featured' : ''}">${skill.skill} ${skill.level ? `(L${skill.level})` : ''}</span>`
                ).join('');

                html += `
                    <div class="person-card">
                        <div class="person-header">
                            <div class="person-info">
                                <h3>${person.displayName || person.primaryEmail}</h3>
                                <p>${person.title || 'No title'} ${person.departmentName ? `• ${person.departmentName}` : ''}</p>
                            </div>
                            <div class="person-score">Score: ${person.skillsScore || 0}</div>
                        </div>
                        ${skillsHtml ? `<div class="skills-list">${skillsHtml}</div>` : ''}
                        ${person.skillsSummary ? `<p style="margin-top: 10px; color: #6b7280;">${person.skillsSummary}</p>` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        

        function showTextResult(containerId, data) {
            const container = document.getElementById(containerId);
            let text = data;
            if (typeof text !== 'string') {
                try {
                    text = JSON.stringify(text, null, 2);
                } catch (_) {
                    text = String(text);
                }
            }
            container.innerHTML = `
                <div class="person-card">
                    <pre style="white-space: pre-wrap; font-family: inherit;">${text}</pre>
                </div>
            `;
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <p>🔄 Loading...</p>
                </div>
            `;
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        // Load org metadata and populate dropdowns
        async function loadOrgMetadata() {
            try {
                const result = await apiCall('/api/org/metadata');
                const { departments, offices } = result.metadata;
                
                // Populate all department dropdowns
                const departmentSelects = ['skills-department'];
                
                departmentSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select && departments.length > 0) {
                        // Clear existing options except "All Departments"
                        select.innerHTML = '<option value="">All Departments</option>';
                        
                        // Add actual departments from org data
                        departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept;
                            option.textContent = dept;
                            select.appendChild(option);
                        });
                    }
                });
                
            } catch (error) {
                console.log('Could not load org metadata:', error.message);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadOrgMetadata();
            // Initialize autocompletes
            setupAutocomplete({ inputId: 'skills-input', listId: 'skills-suggestions', multi: true });
            setupAutocomplete({ inputId: 'quick-skill', listId: 'quick-skill-suggestions', multi: false });
        });
    </script>
</body>
</html>
